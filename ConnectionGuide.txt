Solana-NFT-Forge-with-Anchor Connection Guide
==============================================

Program Information
- Program ID (localnet): BncAjQaJFE7xN4ut2jaAGVSKdrqpuzyuHoiCGTpj1DkN
- Program ID (devnet): BncAjQaJFE7xN4ut2jaAGVSKdrqpuzyuHoiCGTpj1DkN
- Metaplex Token Metadata Program: metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s

Local Development
- Local validator RPC (default): http://127.0.0.1:8899
- Local validator WebSocket (default): ws://127.0.0.1:8900
- Local validator faucet (default): http://127.0.0.1:9900 (binds 0.0.0.0:9900)
- Frontend dev server: http://localhost:3000
- Localnet prerequisite (Token Metadata): start validator with `scripts/start-validator.ps1 -CloneTokenMetadata` so `metaqbxx...` exists on localnet for CPI

Shared Networks
- Solana devnet RPC: https://api.devnet.solana.com
- Solana devnet WebSocket: wss://api.devnet.solana.com
- Solana mainnet RPC: https://api.mainnet-beta.solana.com
- Solana mainnet WebSocket: wss://api.mainnet-beta.solana.com

External Services
- Pinata API base URL: https://api.pinata.cloud
- Pinata public gateway (example): https://gateway.pinata.cloud
- Pinata JWT: Set via PINATA_JWT environment variable
- Solana release downloads (toolchain): https://release.anza.xyz (used to fetch Solana CLI/SBF tarballs; Docker image installs “stable” and now uses solana-cli 3.0.13 / rustc 1.92.0)

Vercel Deployment
- Frontend URL: https://solana-nft-forge.vercel.app
- Env (public): NEXT_PUBLIC_CLUSTER=devnet (set in Vercel dashboard)
- Env (public): NEXT_PUBLIC_SOLANA_RPC_URL=https://api.devnet.solana.com (set in Vercel dashboard)
- Env (public): NEXT_PUBLIC_FORGE_PROGRAM_ID=BncAjQaJFE7xN4ut2jaAGVSKdrqpuzyuHoiCGTpj1DkN (set in Vercel dashboard)
- Env (public): NEXT_PUBLIC_FORGE_AUTHORITY=Fx2ydi5tp6Zu2ywMJEZopCXUqhChehKWBnKNgQjcJnSA (optional - defaults in code if not set)
- Note: Do NOT set NEXT_PUBLIC_FORGE_AUTHORITY in Vercel if it's truncated. The code will use the correct default.

IDL Locations
- Generated IDL: target/idl/forge.json
- Scripts IDL: scripts/idl/forge.json
- Frontend IDL: app/public/idl/forge.json

Developer Tool Paths
- Anchor CLI: C:\Users\dseib\.avm\bin\anchor.exe
- Solana/Agave install root (active): C:\solana\install
- Localnet validator binary (recommended on Windows): C:\solana\install\releases\2.3.13\solana-release\bin\solana-test-validator.exe

CLI Script Endpoints
- Scripts run from: scripts/ directory
- Commands: npm run init-forge, create-recipe, toggle-recipe, forge-asset, forge-example
- Devnet recipe creation: Set CLUSTER=devnet and SOLANA_RPC_URL=https://api.devnet.solana.com before running scripts
- Example: $env:CLUSTER="devnet"; $env:SOLANA_RPC_URL="https://api.devnet.solana.com"; npm run create-recipe -- -s iron-sword -v 2 -k one-of-one -u "https://..." --status active

Transaction Configuration
- Compute Budget: Forge transactions include Compute Budget Program instructions to request 400,000 compute units (double the default 200k) to prevent CU exhaustion during NFT minting with metadata
- Priority Fee: Transactions include a small priority fee (1 microLamport) to help with transaction processing
- Implementation: Compute budget instructions are added via `.preInstructions()` in both frontend (app/app/mint/[slug]/page.tsx) and CLI scripts (scripts/src/forge-asset.ts)

Deployment Information
- Latest Deployment (2025-12-19): Signature 1uXb9Se5ReANvkPB3KtqGeewvWAwZe6NpxotBKdNm9otJfRQiRw6UoNV2vd7YESBixys4pimjR7LtHRpeA5adn3
- Deployment Method: Docker (docker-deploy.ps1 script)
- Hash Logic Update: Program now includes BOTH forger's pubkey AND mint pubkey in hash for 0-ingredient recipes, allowing each wallet to forge multiple times (each mint is unique)
- Docker Image: solana-forge-deploy (Ubuntu 24.04 with Anchor 0.32.1)
- Hash Computation: hashv(&[forger_pubkey, mint_pubkey]) = SHA256(forger_pubkey || mint_pubkey)
- Network Configuration: Frontend validates network match (devnet required) and checks program existence before forging

Network Configuration (CRITICAL)
- Frontend is configured for DEVNET only (program deployed to devnet)
- Wallet MUST be connected to Devnet, NOT Mainnet
- MetaMask Solana Snap: User must manually switch to Devnet in MetaMask settings
- Phantom/Solflare: Wallet adapters are configured with network parameter, but user should verify network selection
- Network Validation: Frontend now validates network match before allowing transactions
- Program Existence Check: Frontend verifies program exists on connected network before forging

